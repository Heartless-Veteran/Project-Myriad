pull_request_rules:
  - name: Assign t-shirt size XS to PR
    description: Assign XS size label to very small pull requests
    conditions:
      - "#modified-lines < 10"
    actions:
      label:
        toggle:
          - size/XS
  - name: Assign t-shirt size S to PR
    description: Assign S size label to small pull requests
    conditions:
      - "#modified-lines >= 10"
      - "#modified-lines < 50"
    actions:
      label:
        toggle:
          - size/S
  - name: Assign t-shirt size M to PR
    description: Assign M size label to medium pull requests
    conditions:
      - "#modified-lines >= 50"
      - "#modified-lines < 100"
    actions:
      label:
        toggle:
          - size/M
  - name: Assign t-shirt size L to PR
    description: Assign L size label to large pull requests
    conditions:
      - "#modified-lines >= 100"
      - "#modified-lines < 500"
    actions:
      label:
        toggle:
          - size/L
  - name: Assign t-shirt size XL to PR
    description: Assign XL size label to very large pull requests
    conditions:
      - "#modified-lines >= 500"
    actions:
      label:
        toggle:
          - size/XL
  - name: Label Android-specific changes
    description: Add android label for Android-specific file changes
    conditions:
      - or:
          - files ~= (?i)\.(kt|java)$
          - files ~= ^app/
    actions:
      label:
        toggle:
          - android
  - name: Label documentation changes
    description: Add documentation label for documentation changes
    conditions:
      - files ~= (?i)\.(md|txt|rst)$
      - files ~= ^docs/
    actions:
      label:
        toggle:
          - documentation
  - name: Label build system changes
    description: Add build-system label for build configuration changes
    conditions:
      - files ~= (?i)(build\.gradle|gradle\.properties|settings\.gradle)
      - files ~= ^gradle/
    actions:
      label:
        toggle:
          - build-system
  - name: Label CI/CD changes
    description: Add ci-cd label for workflow changes
    conditions:
      - files ~= ^\.github/workflows/
      - files ~= (?i)(\.mergify\.yml|dependabot\.yml)
    actions:
      label:
        toggle:
          - ci-cd
  - name: Label security-related changes
    description: Add security label for security-related file changes
    conditions:
      - files ~= (?i)(security|vulnerabilit|auth|token|key|secret|password|encrypt)
      - files ~= ^SECURITY\.md$
    actions:
      label:
        toggle:
          - security
  - name: Make sure PRs are updated before merging with rebase
    description: This automatically rebases PRs when they are out-of-date with the
      base branch to avoid semantic conflicts (next step is switch to merge
      queue).
    conditions:
      - "#commits-behind >= 5"
      - label = automerge
    actions:
      rebase:
  - name: Label draft pull requests
    description: Add WIP label to draft pull requests
    conditions:
      - draft
    actions:
      label:
        toggle:
          - WIP
  - name: Automatic merge
    description: Merge when PR passes all branch protection and has label automerge
    conditions:
      - label = automerge
      - -draft
      - or:
          # Primary check format (workflow / job)
          - and:
              - "check-success=CI - Build and Test / test"
              - "check-success=CI - Build and Test / android-build" 
              - "check-success=Java CI with Gradle / build"
              - "check-success=Code Quality - Super Linter / super-linter"
          # Alternative check format (job name only)
          - and:
              - check-success=test
              - check-success=android-build
              - check-success=build
              - check-success=super-linter
          # Legacy status check format
          - and:
              - status-success=test
              - status-success=android-build
              - status-success=build
              - status-success=super-linter
    actions:
      merge:
        method: merge
        delete_head_branch: true
  - name: Label Mergify Stacks PRs
    description: Pull requests that are part of a Mergify stack should be labeled as such
    conditions:
      - "commits[0].commit_message ~= (?m)Change-Id:"
    actions:
      label:
        toggle:
          - stack
  - name: Label conflicting pull requests
    description: Add a label to a pull request with conflict to spot it easily
    conditions:
      - conflict
      - -closed
    actions:
      label:
        toggle:
          - conflict
  - name: Notify when a PR is removed from the queue
    description: Notify the PR author when its pull request is removed from the merge queue.
    conditions:
      - queue-dequeue-reason != none
      - queue-dequeue-reason != pr-merged
    actions:
      comment:
        message: >
          Hey @{{author}}, your pull request has been dequeued due to the
          following reason: {{queue_dequeue_reason}}.

          Sorry about that, but you can requeue the PR by using `@mergifyio
          requeue` if you think this was a mistake.
